<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PORTAL DEX - ALL IN ONE</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Courier New', monospace; background: #000; color: #0f0; overflow: hidden; position: relative; height: 100vh; }
    
    /* TOP BAR - CLEAN & TIGHT */
    #top-bar { position: absolute; top: 0; left: 0; right: 0; height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; z-index: 300; }
    #bgm-controls button { padding: 8px 14px; font-size: 0.9rem; background: #0f0; color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    #show-clues { padding: 10px 20px; font-size: 1rem; background: #6a5acd; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
    #top-right { display: flex; gap: 10px; }
    #disembed, #reset { padding: 8px 16px; font-size: 0.9rem; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    #disembed { background: #e67e22; color: white; display: none; }
    #reset { background: #c0392b; color: white; }

    /* PLAY VIDEO BUTTON */
    #play-video { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 250; display: none; padding: 24px 60px; font-size: 2.2rem; background: #6a5acd; color: white; border: none; border-radius: 30px; cursor: pointer; box-shadow: 0 0 50px #6a5acd, 0 0 20px #000; font-weight: bold; text-shadow: 0 0 15px #000; transition: all 0.3s; }
    #play-video:hover { transform: translate(-50%, -50%) scale(1.08); }

    /* VIDEO */
    #video-container { position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; opacity: 0; transition: opacity 1.5s ease; pointer-events: none; z-index: 100; }
    #video-container.active { opacity: 1; pointer-events: auto; }
    #video-container iframe { width: 92vw; height: 72vh; max-width: 1300px; max-height: 850px; border: 5px solid #0f0; border-radius: 25px; box-shadow: 0 0 40px #0f0, 0 0 80px rgba(0, 255, 0, 0.3); }

    /* STATUS */
    #status { position: absolute; bottom: 20px; left: 20px; font-size: 1.3rem; color: #0f0; font-weight: bold; z-index: 200; }

    /* CLUE PANEL */
    #clue-panel { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10,0,31,0.98); padding: 30px; border-radius: 20px; border: 3px solid #6a5acd; color: #e0f8ff; z-index: 400; display: none; max-width: 90%; width: 500px; box-shadow: 0 0 40px #6a5acd; }
    #clue-panel h2 { text-align: center; margin-bottom: 20px; text-shadow: 0 0 10px #6a5acd; font-size: 1.8rem; }
    .input-group { margin: 15px 0; }
    select, input, button { font-size: 1.1em; padding: 10px; margin: 5px 0; border-radius: 10px; border: none; width: 100%; }
    select { background: #2a1b4d; color: white; }
    input { background: #1e1e2e; color: #0f0; text-align: center; }
    button { background: #6a5acd; color: white; cursor: pointer; font-weight: bold; font-size: 1rem; }
    button:hover { background: #8a2be2; }
    #clue-status { margin-top: 15px; font-size: 1.2em; color: #0f0; text-align: center; min-height: 1.5em; }
    .color-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin: 12px 0; }
    .color-btn { padding: 14px; border-radius: 12px; font-weight: bold; color: white; cursor: pointer; font-size: 0.85em; }
    #close-clues { margin-top: 20px; background: #c0392b; font-size: 1rem; padding: 10px; }
  </style>
</head>
<body>

  <!-- TOP BAR -->
  <div id="top-bar">
    <div id="bgm-controls">
      <button onclick="startBGM()">PLAY BGM</button>
      <button onclick="stopBGM()">STOP BGM</button>
    </div>
    <button id="show-clues" onclick="toggleClues()">ENTER CLUE</button>
    <div id="top-right">
      <button id="disembed" onclick="disembedVideo()">DIS-EMBED</button>
      <button id="reset" onclick="resetAll()">RESET</button>
    </div>
  </div>

  <!-- PLAY VIDEO -->
  <button id="play-video" onclick="embedVideo()">PLAY VIDEO</button>

  <!-- VIDEO -->
  <div id="video-container">
    <iframe id="vimeo-player" src="" frameborder="0" allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share" allowfullscreen></iframe>
  </div>

  <!-- STATUS -->
  <div id="status">Status: Ready</div>

  <!-- CLUE PANEL -->
  <div id="clue-panel">
    <h2>ENTER MAGIC CLUE</h2>

    <div class="input-group">
      <label>MAGIC NUMBER (4 digits):</label>
      <input type="text" id="num" maxlength="4" placeholder="????">
      <button onclick="tryClue('num')">SUBMIT</button>
    </div>

    <div class="input-group">
      <label>MAGIC COLORS (click 4 in order):</label>
      <div id="color-grid" class="color-grid"></div>
      <input type="text" id="colors" readonly placeholder="Click 4 colors">
      <button onclick="tryClue('colors')">SUBMIT</button>
      <button style="background:#c0392b; font-size:0.9em; padding:8px;" onclick="resetColors()">RESET</button>
    </div>

    <div class="input-group">
      <label>MAGIC DATE:</label>
      <select id="month">
        <option>Ennuary</option><option>Jannuary</option><option>February</option><option>MArch</option>
        <option>April</option><option>May</option><option>June</option><option>July</option>
        <option>August</option><option>September</option><option>October</option><option>November</option>
        <option>December</option><option>Hexember</option><option>Zerini</option>
      </select>
      <input type="number" id="day" min="1" max="31" placeholder="Day">
      <input type="number" id="year" min="0" max="9999" placeholder="Year">
      <button onclick="tryClue('date')">SUBMIT</button>
    </div>

    <div id="clue-status"></div>
    <button id="close-clues" onclick="toggleClues()">CLOSE</button>
  </div>

  <audio id="bgm" loop></audio>

  <script>
    const bgm = document.getElementById('bgm');
    const status = document.getElementById('status');
    const playBtn = document.getElementById('play-video');
    const videoContainer = document.getElementById('video-container');
    const iframe = document.getElementById('vimeo-player');
    const cluePanel = document.getElementById('clue-panel');
    const bgmFiles = [
      'YES - Dark Ruins - BGM.mp3',
      'YES - Enchanted Shadows - Dark BGM.mp3',
      'YES - Shadow Hallows_ Instrumental Halloween Fantasy.mp3'
    ];
    let currentBGM = 0;
    let pendingClue = null;

    const videoUrls = {
      num: 'https://player.vimeo.com/video/1131397582?badge=0&autopause=0&player_id=0&app_id=58479&autoplay=1',
      colors: 'https://player.vimeo.com/video/1131398566?badge=0&autopause=0&player_id=0&app_id=58479&autoplay=1',
      date: 'https://player.vimeo.com/video/1131411707?badge=0&autopause=0&player_id=0&app_id=58479&autoplay=1'
    };

    const clueTitles = { num: 'MAGIC NUMBER', colors: 'MAGIC COLORS', date: 'MAGIC DATE' };

    // CLUES
    let selectedColors = [];
    const CLUES = {
      num: '5210',
      colors: ['BLUE','ORANGE','PURPLE','GREEN'],
      date: { m: 'Ennuary', d: 31, y: 1540 }
    };

    const colorData = [
      { name: 'BLUE',   color: '#3498db' }, { name: 'ORANGE', color: '#e67e22' },
      { name: 'PURPLE', color: '#9b59b6' }, { name: 'GREEN',  color: '#27ae60' },
      { name: 'YELLOW', color: '#f1c40f' }, { name: 'RED',    color: '#e74c3c' },
      { name: 'BROWN',  color: '#8b4513' }, { name: 'BLACK',  color: '#2c3e50' },
      { name: 'WHITE',  color: '#ecf0f1' }
    ];

    function shuffle(a) { for (let i = a.length-1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }
    function renderColorGrid() {
      const grid = document.getElementById('color-grid'); grid.innerHTML = '';
      shuffle([...colorData]).forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'color-btn'; btn.style.backgroundColor = item.color;
        btn.textContent = item.name; btn.onclick = () => addColor(item.name);
        grid.appendChild(btn);
      });
    }
    function addColor(c) { if (selectedColors.length >= 4) return; selectedColors.push(c); document.getElementById('colors').value = selectedColors.join(', '); }
    function resetColors() { selectedColors = []; document.getElementById('colors').value = ''; }

    function tryClue(type) {
      const status = document.getElementById('clue-status');
      let correct = false;
      let clueKey = null;

      if (type === 'num' && document.getElementById('num').value.trim() === CLUES.num) { correct = true; clueKey = 'num'; }
      if (type === 'colors' && selectedColors.length === 4 && selectedColors.join(',') === CLUES.colors.join(',')) { correct = true; clueKey = 'colors'; resetColors(); }
      if (type === 'date') {
        const m = document.getElementById('month').value;
        const d = parseInt(document.getElementById('day').value);
        const y = parseInt(document.getElementById('year').value);
        if (m === CLUES.date.m && d === CLUES.date.d && y === CLUES.date.y) { correct = true; clueKey = 'date'; }
      }

      if (correct) {
        pendingClue = clueKey;
        status.innerHTML = `CLUE ACCEPTED: ${clueKey.toUpperCase()}`;
        playBtn.style.display = 'block';
        playBtn.textContent = `PLAY: ${clueTitles[clueKey]}`;
        setTimeout(toggleClues, 1000);
      } else {
        status.textContent = 'Invalid clue.';
      }
      setTimeout(() => status.textContent = '', 4000);
    }

    function toggleClues() {
      const isOpen = cluePanel.style.display === 'block';
      cluePanel.style.display = isOpen ? 'none' : 'block';
      if (!isOpen) renderColorGrid();
    }

    function startBGM() {
      bgm.src = bgmFiles[currentBGM];
      bgm.play().catch(() => {});
      status.textContent = `BGM ${currentBGM + 1} playing`;
    }

    function stopBGM() { bgm.pause(); }

    function embedVideo() {
      if (!pendingClue) return;
      stopBGM();
      iframe.src = videoUrls[pendingClue];
      videoContainer.classList.add('active');
      document.getElementById('disembed').style.display = 'block';
      playBtn.style.display = 'none';
      status.textContent = `${clueTitles[pendingClue]} playing...`;
    }

    function disembedVideo() {
      iframe.src = '';
      videoContainer.classList.remove('active');
      document.getElementById('disembed').style.display = 'none';
      currentBGM = (currentBGM + 1) % bgmFiles.length;
      startBGM();
      pendingClue = null;
      status.textContent = 'Ready for next clue.';
    }

    function resetAll() {
      stopBGM();
      iframe.src = '';
      videoContainer.classList.remove('active');
      document.getElementById('disembed').style.display = 'none';
      playBtn.style.display = 'none';
      pendingClue = null;
      currentBGM = 0;
      status.textContent = 'Reset complete.';
      cluePanel.style.display = 'none';
    }

    document.body.addEventListener('click', function init() {
      if (!bgm.src) startBGM();
      document.body.removeEventListener('click', init);
    }, { once: true });
  </script>
</body>
</html>
